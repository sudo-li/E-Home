#include "lcd.h"
#include "ds1302.h"
//#include "DHT11.h"

/*--  文字:  年  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
char code nian[] = {0x00,0x20,0x18,0xC7,0x44,0x44,0x44,0x44,0xFC,0x44,0x44,0x44,0x44,0x04,0x00,0x00,
					0x04,0x04,0x04,0x07,0x04,0x04,0x04,0x04,0xFF,0x04,0x04,0x04,0x04,0x04,0x04,0x00};

/*--  文字:  月  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
char code yue[] = {0x00,0x00,0x00,0xFE,0x22,0x22,0x22,0x22,0x22,0x22,0x22,0x22,0xFE,0x00,0x00,0x00,
				   0x80,0x40,0x30,0x0F,0x02,0x02,0x02,0x02,0x02,0x02,0x42,0x82,0x7F,0x00,0x00,0x00};

/*--  文字:  日  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
char code ri[] = {0x00,0x00,0x00,0xFE,0x82,0x82,0x82,0x82,0x82,0x82,0x82,0xFE,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0xFF,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0xFF,0x00,0x00,0x00,0x00};

char code mao_hao[]={ 
/*-- 文字: : (冒号） --*/ 
/*-- 宋体 12; 此字体下对应的点阵为：宽 x 高=8x16 --*/ 
0x00,0x00,0x00,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00};

/*-- 文字: + (加号） --*/ 
/*-- 宋体 12; 此字体下对应的点阵为：宽 x 高=8x16 --*/ 
char code jia_hao[]={0x00,0x80,0x80,0xE0, 0xE0,0x80,0x80,0x00, 0x00,0x00,0x00,0x03, 0x03,0x00,0x00,0x00}; //-+-

/*-- 文字: - (减号） --*/ 
/*-- 宋体 12; 此字体下对应的点阵为：宽 x 高=8x16 --*/ 
char code jian_hao[]={0x80,0x80,0x80,0x80, 0x80,0x80,0x80,0x00, 0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00}; //---

/*-- 文字: . (点） --*/ 
/*-- 宋体 12; 此字体下对应的点阵为：宽 x 高=8x16 --*/ 
char code dian[]={0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x0C, 0x0C,0x00,0x00,0x00}; //-.-

/*--  文字:  ℃  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
char code wendu[]={0x06,0x09,0x09,0xE6,0xF8,0x0C,0x04,0x02,0x02,0x02,0x02,0x02,0x04,0x1E,0x00,0x00,
					0x00,0x00,0x00,0x07,0x1F,0x30,0x20,0x40,0x40,0x40,0x40,0x40,0x20,0x10,0x00,0x00};

/*-- 文字: % (百分号） --*/ 
/*-- 宋体 12; 此字体下对应的点阵为：宽 x 高=8x16 --*/ 
char code baifen_hao[]={0x30,0x30,0x00,0x80, 0xC0,0x60,0x30,0x00, 0x0C,0x06,0x03,0x01, 0x00,0x0C,0x0C,0x00}; //-%-

/*--  文字:  O  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=8x16   --*/
char code O[]={0xE0,0x10,0x08,0x08,0x08,0x10,0xE0,0x00,0x0F,0x10,0x20,0x20,0x20,0x10,0x0F,0x00};

/*--  文字:  N  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=8x16   --*/
char code N[]={0x08,0xF8,0x30,0xC0,0x00,0x08,0xF8,0x08,0x20,0x3F,0x20,0x00,0x07,0x18,0x3F,0x00};

/*--  文字:  F  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=8x16   --*/
char code F[]={0x08,0xF8,0x88,0x88,0xE8,0x08,0x10,0x00,0x20,0x3F,0x20,0x00,0x03,0x00,0x00,0x00};

///*--  文字:  一  --*/
///*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
//char code one[]={0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x00,
//				 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

///*--  文字:  二  --*/
///*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
//char code two[]={0x00,0x00,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x00,0x00,0x00,
//				0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x00};

///*--  文字:  三  --*/
///*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
//char code three[]={0x00,0x04,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x04,0x00,0x00,
//				0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x00};

///*--  文字:  四  --*/
///*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
//char code four[]={0x00,0xFC,0x04,0x04,0x04,0xFC,0x04,0x04,0x04,0xFC,0x04,0x04,0x04,0xFC,0x00,0x00,
//				0x00,0x7F,0x28,0x24,0x23,0x20,0x20,0x20,0x20,0x21,0x22,0x22,0x22,0x7F,0x00,0x00};

///*--  文字:  五  --*/
///*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
//char code five[]={0x00,0x02,0x42,0x42,0x42,0xC2,0x7E,0x42,0x42,0x42,0x42,0xC2,0x02,0x02,0x00,0x00,
//				0x40,0x40,0x40,0x40,0x78,0x47,0x40,0x40,0x40,0x40,0x40,0x7F,0x40,0x40,0x40,0x00};

///*--  文字:  六  --*/
///*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
//char code six[]={0x20,0x20,0x20,0x20,0x20,0x20,0x21,0x22,0x2C,0x20,0x20,0x20,0x20,0x20,0x20,0x00,
//				0x00,0x40,0x20,0x10,0x0C,0x03,0x00,0x00,0x00,0x01,0x02,0x04,0x18,0x60,0x00,0x00};

char code week[7][32] = {{0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},//一
						{0x00,0x00,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x00,0x00,0x00,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x00},//二
						{0x00,0x04,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x04,0x00,0x00,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x00},//三
						{0x00,0xFC,0x04,0x04,0x04,0xFC,0x04,0x04,0x04,0xFC,0x04,0x04,0x04,0xFC,0x00,0x00,0x00,0x7F,0x28,0x24,0x23,0x20,0x20,0x20,0x20,0x21,0x22,0x22,0x22,0x7F,0x00,0x00},//四
						{0x00,0x02,0x42,0x42,0x42,0xC2,0x7E,0x42,0x42,0x42,0x42,0xC2,0x02,0x02,0x00,0x00,0x40,0x40,0x40,0x40,0x78,0x47,0x40,0x40,0x40,0x40,0x40,0x7F,0x40,0x40,0x40,0x00},//五
						{0x20,0x20,0x20,0x20,0x20,0x20,0x21,0x22,0x2C,0x20,0x20,0x20,0x20,0x20,0x20,0x00,0x00,0x40,0x20,0x10,0x0C,0x03,0x00,0x00,0x00,0x01,0x02,0x04,0x18,0x60,0x00,0x00},//六
						{0x00,0x00,0x00,0xFE,0x82,0x82,0x82,0x82,0x82,0x82,0x82,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0xFF,0x00,0x00,0x00,0x00},
						};//日

//char code num0[]={ 
///*-- 文字: 0 --*/ 
///*-- 宋体 12; 此字体下对应的点阵为：宽 x 高=8x16 --*/ 
//0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,0x00,0x0F,0x10,0x20,0x20,0x10,0x0F,0x00};

//char code num1[]={
///*-- 文字: 1 --*/ 
///*-- 宋体 12; 此字体下对应的点阵为：宽 x 高=8x16 --*/ 
//0x00,0x10,0x10,0xF8,0x00,0x00,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00 }; 

//char code num2[]={ 
///*-- 文字: 2 --*/ 
///*-- 宋体 12; 此字体下对应的点阵为：宽 x 高=8x16 --*/ 
//0x00,0x70,0x08,0x08,0x08,0x88,0x70,0x00,0x00,0x30,0x28,0x24,0x22,0x21,0x30,0x00 }; 

//char code num3[]={ 
///*-- 文字: 3 --*/ 
///*-- 宋体 12; 此字体下对应的点阵为：宽 x 高=8x16 --*/ 
//0x00,0x30,0x08,0x88,0x88,0x48,0x30,0x00,0x00,0x18,0x20,0x20,0x20,0x11,0x0E,0x00 }; 

//char code num4[]={ 
///*-- 文字: 4 --*/ 
///*-- 宋体 12; 此字体下对应的点阵为：宽 x 高=8x16 --*/ 
//0x00,0x00,0xC0,0x20,0x10,0xF8,0x00,0x00,0x00,0x07,0x04,0x24,0x24,0x3F,0x24,0x00 }; 

//char code num5[]={ 
///*-- 文字: 5 --*/ 
///*-- 宋体 12; 此字体下对应的点阵为：宽 x 高=8x16 --*/ 
//0x00,0xF8,0x08,0x88,0x88,0x08,0x08,0x00,0x00,0x19,0x21,0x20,0x20,0x11,0x0E,0x00 }; 

//char code num6[]={ 
///*-- 文字: 6 --*/ 
///*-- 宋体 12; 此字体下对应的点阵为：宽 x 高=8x16 --*/ 
//0x00,0xE0,0x10,0x88,0x88,0x18,0x00,0x00,0x00,0x0F,0x11,0x20,0x20,0x11,0x0E,0x00 }; 

//char code num7[]={ 
///*-- 文字: 7 --*/ 
///*-- 宋体 12; 此字体下对应的点阵为：宽 x 高=8x16 --*/ 
//0x00,0x38,0x08,0x08,0xC8,0x38,0x08,0x00,0x00,0x00,0x00,0x3F,0x00,0x00,0x00,0x00 }; 

//char code num8[]={ 
///*-- 文字: 8 --*/ 
///*-- 宋体 12; 此字体下对应的点阵为：宽 x 高=8x16 --*/ 
//0x00,0x70,0x88,0x08,0x08,0x88,0x70,0x00,0x00,0x1C,0x22,0x21,0x21,0x22,0x1C,0x00 }; 

//char code num9[]={ 
///*-- 文字: 9 --*/ 
///*-- 宋体 12; 此字体下对应的点阵为：宽 x 高=8x16 --*/ 
//0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,0x00,0x00,0x31,0x22,0x22,0x11,0x0F,0x00 };

char code num[10][16] = {{0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,0x00,0x0F,0x10,0x20,0x20,0x10,0x0F,0x00},//0
					    {0x00,0x10,0x10,0xF8,0x00,0x00,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00},//1
						{0x00,0x70,0x08,0x08,0x08,0x88,0x70,0x00,0x00,0x30,0x28,0x24,0x22,0x21,0x30,0x00},//2
						{0x00,0x30,0x08,0x88,0x88,0x48,0x30,0x00,0x00,0x18,0x20,0x20,0x20,0x11,0x0E,0x00},//3
						{0x00,0x00,0xC0,0x20,0x10,0xF8,0x00,0x00,0x00,0x07,0x04,0x24,0x24,0x3F,0x24,0x00},//4
						{0x00,0xF8,0x08,0x88,0x88,0x08,0x08,0x00,0x00,0x19,0x21,0x20,0x20,0x11,0x0E,0x00},//5
						{0x00,0xE0,0x10,0x88,0x88,0x18,0x00,0x00,0x00,0x0F,0x11,0x20,0x20,0x11,0x0E,0x00},//6
						{0x00,0x38,0x08,0x08,0xC8,0x38,0x08,0x00,0x00,0x00,0x00,0x3F,0x00,0x00,0x00,0x00},//7
						{0x00,0x70,0x88,0x08,0x08,0x88,0x70,0x00,0x00,0x1C,0x22,0x21,0x21,0x22,0x1C,0x00},//8
						{0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,0x00,0x00,0x31,0x22,0x22,0x11,0x0F,0x00},//9
					  };

					   
void Write_command(int data1) //写指令
{
	char i;
	L_CS=0;
	L_RS=0;
	for(i=0;i<8;i++)
	{
		L_SCLK=0;
		if (data1&0x80) L_SDA=1;
		else L_SDA=0;
		L_SCLK=1;
		data1=data1<<=1;
	}
}

void Write_data(int data1)//写数据
{
	char i;
	L_CS=0;
	L_RS=1;
	for(i=0;i<8;i++)
	{
		L_SCLK=0;
		if (data1&0x80) L_SDA=1;
		else L_SDA=0;
		L_SCLK=1;
		data1=data1<<=1;
	}
}

void lcd_delay(int i)
{
	int j,k;
	for (j=0;j<i;j++)
		for (k=0;k<110;k++) ;
}

void Init_lcd()
{
      L_CS=0;
      L_RESET=0;  /*低电平复位*/
	  lcd_delay(100);
      L_RESET=1;  /*复位完毕*/
	  lcd_delay(20);
      Write_command(0xe2);  /*软复位*/
	  lcd_delay(5);
      Write_command(0x2c); /*升压步聚 1*/
	  lcd_delay(5);
      Write_command(0x2e); /*升压步 聚2*/
	  lcd_delay(5);
      Write_command(0x2f); /*升压步 聚3*/
	  lcd_delay(5);
      Write_command(0x23); /*粗调对比度， 可设置范围0x20~0x27*/
	  Write_command(0x81); /*微调对 比度*/
      Write_command(0x28); /*0xla, 微调对比度的值，可设置范围0x00~0x3f*/
	  Write_command(0xa2); /*1/9 偏压比(bias) */
	  Write_command(0xc8); /*行扫描顺序: 从上到下*/
	  Write_command(0xa0); /*列扫描顺序: 从左到右*/
	  Write_command(0x40); /*起始行: 第- -行开始*/
	  Write_command(0xaf); /*开 显示*/
	  L_CS=1;
}



void lcd_address(uchar page,uchar column)//lcd定位地址 page 页 column 列
{
      L_CS=0;
      column=column-1;
	  page=page-1;
      Write_command(0xb0+page);
      Write_command(((column>>4)&0x0f)+0x10);
	  Write_command(column&0x0f);
}

void clear_all()//全屏清屏
{
      uchar i,j;
	  L_CS=0;
      for(i=0;i<9;i++)
	  {
	      lcd_address(1+i,1);
		  for (j=0;j<132;j++)
		  {
	      	Write_data(0x00);
		  }
	  }
	  L_CS=1;
}

//void full_display()//全部显示
//{
//	int i,j;
//	for(i=0;i<8;i++)
//	{
//		L_CS=0;
//		lcd_address(i+1,0);
//		for(j=0;j<128;j++)
//		{
//			Write_data(0xff);
//		}
//	}
//}

void display_graphic_16x16(uchar page, uchar column, uchar *dp)
{
      uchar i,j;
      L_CS=0;
      for (j=0;j<2;j++)
	  {	
	      lcd_address(page+j,column);
		  for (i=0;i<16;i++)
		  {
	      	Write_data(*dp);  /*写数据到LCD,靶赐- -个8位的数据后列地址自幼加1*/
			dp++;
          }
	  }
	  L_CS=1;
}


void display_graphic_8x16(uchar page, uchar column, uchar *dp)
{
	uchar i,j;
	L_CS=0;
	for (j=0;j<2;j++)
	{
		lcd_address(page+j,column);
		for (i=0;i<8;i++)
		{
			Write_data(*dp);
			dp++;
		}
	}
	L_CS=1;
}

void clear_8x16(uchar page, uchar column)
{
	uchar i,j;
	L_CS=0;
	for (j=0;j<2;j++)
	{
		lcd_address(page+j,column);
		for (i=0;i<8;i++)
		{
			Write_data(0x00);
		}
	}
	L_CS=1;
}

void time_display()
{
	Read_ds1302time();
	display_graphic_8x16(1,8*2,&num[(time[6] / 16)][0]);
	display_graphic_8x16(1,8*3,&num[(time[6] & 0x0f)][0]);
	display_graphic_16x16(1,16*2,nian);
	display_graphic_8x16(1,8*6,&num[(time[4] / 16)][0]);
	display_graphic_8x16(1,8*7,&num[(time[4] & 0x0f)][0]);
	display_graphic_16x16(1,16*4,yue);
	display_graphic_8x16(1,8*10,&num[(time[3] / 16)][0]);
	display_graphic_8x16(1,8*11,&num[(time[3] & 0x0f)][0]);
	display_graphic_16x16(1,16*6,ri);
	
	display_graphic_16x16(1,16*7+2,&week[(time[5] & 0x0f)-1][0]);
	
	display_graphic_8x16(3,8*3,&num[(time[2] / 16)][0]);
	display_graphic_8x16(3,8*4,&num[(time[2] & 0x0f)][0]);
	display_graphic_8x16(3,8*5,mao_hao);
	display_graphic_8x16(3,8*6,&num[(time[1] / 16)][0]);
	display_graphic_8x16(3,8*7,&num[(time[1] & 0x0f)][0]);
	display_graphic_8x16(3,8*8,mao_hao);
	display_graphic_8x16(3,8*9,&num[(time[0] / 16)][0]);
	display_graphic_8x16(3,8*10,&num[(time[0] & 0x0f)][0]);
	
}

void Ds18b20_display(int temp)
{
	float tp;  
	if(temp< 0)				//当温度值为负数
  	{
		display_graphic_8x16(7,8*2,jian_hao);
		//因为读取的温度是实际温度的补码，所以减1，再取反求出原码
		temp=temp-1;
		temp=~temp;
		tp=temp;
		temp=tp*0.0625*100+0.5;	
		//留两个小数点就*100，+0.5是四舍五入，因为C语言浮点数转换为整型的时候把小数点
		//后面的数自动去掉，不管是否大于0.5，而+0.5之后大于0.5的就是进1了，小于0.5的就
		//算由?.5，还是在小数点后面。
 
  	}
 	else
  	{			
		display_graphic_8x16(7,8*2,jia_hao);
		tp=temp;//因为数据处理有小数点所以将温度赋给一个浮点型变量
		//如果温度是正的那么，那么正数的原码就是补码它本身
		temp=tp*0.0625*100+0.5;	
		//留两个小数点就*100，+0.5是四舍五入，因为C语言浮点数转换为整型的时候把小数点
		//后面的数自动去掉，不管是否大于0.5，而+0.5之后大于0.5的就是进1了，小于0.5的就
		//算加上0.5，还是在小数点后面。
	}
	display_graphic_8x16(7,8*3,&num[temp%10000/1000][0]);
	display_graphic_8x16(7,8*4,&num[temp%1000/100][0]);
	display_graphic_8x16(7,8*5,dian);
	display_graphic_8x16(7,8*6,&num[temp%100/10][0]);
	//display_graphic_8x16(6,8*5,&num[temp%10][0]);
	display_graphic_16x16(7,8*7,wendu);
}

//void DHT11_display()
//{
//	uchar zhumidity;
//	DHT11_Read_Data(&zhumidity);
//	display_graphic_8x16(7,8*10,&num[zhumidity/10][0]);
//	display_graphic_8x16(7,8*11,&num[zhumidity%10][0]);
//	//display_graphic_8x16(6,8*11,dian);
//	//display_graphic_8x16(6,8*13,&num[xhumidity/10][0]);
//	//display_graphic_8x16(6,8*12,&num[xhumidity%10][0]);
//	display_graphic_8x16(7,8*12,baifen_hao);
//}

